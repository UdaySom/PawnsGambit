# Strapi Backend Setup Guide

## Initial Setup

### 1. Start Strapi Development Server

```bash
cd pawns-gambit-cms
npm run develop
```

This will start Strapi on `http://localhost:1337`

### 2. Create Admin Account

1. Navigate to `http://localhost:1337/admin`
2. Create your first admin account with:
   - Username
   - Email
   - Password (minimum 8 characters)

### 3. Configure Permissions

#### Public Role Permissions
Go to **Settings → Users & Permissions Plugin → Roles → Public**

Enable the following permissions (find → check):

**Achievement**
- [x] find
- [x] findOne

**Community Member**
- [x] find
- [x] findOne

**Event**
- [x] find
- [x] findOne

**News**
- [x] find
- [x] findOne

**Partner**
- [x] find
- [x] findOne

**Podcast**
- [x] find
- [x] findOne

**Press**
- [x] find
- [x] findOne

**Tag**
- [x] find
- [x] findOne

**Team Member**
- [x] find
- [x] findOne

**Timeline Event**
- [x] find
- [x] findOne

#### Authenticated Role Permissions
Go to **Settings → Users & Permissions Plugin → Roles → Authenticated**

Enable all Public permissions plus:

**Event**
- [x] All permissions from Public
- [x] update (for registration)

**Podcast**
- [x] All permissions from Public
- [x] update (for incrementing listens)

**Users-Permissions**
- [x] me (to get current user)

### 4. Verify Content Types

Go to **Content-Type Builder** and verify all these content types exist:
- ✓ Achievement
- ✓ Community Member
- ✓ Event
- ✓ News
- ✓ Partner
- ✓ Podcast
- ✓ Press
- ✓ Tag
- ✓ Team Member
- ✓ Timeline Event

### 5. Add Sample Data (Optional)

Navigate to **Content Manager** and add sample entries for each content type to test the frontend integration.

#### Sample Podcast Episode
- Title: "Opening Moves: Chess Strategy for Beginners"
- Number: 1
- Description: "In our first episode, we explore fundamental chess openings..."
- Duration: 45 (minutes)
- Publish Date: Today's date
- Featured: true
- Upload an artwork image
- Upload an audio file

#### Sample Event
- Title: "Chess Championship 2025"
- Event Type: tournament
- Start Date: Future date
- Location: "Community Center"
- Featured: true
- Upload a cover image

#### Sample Team Member
- Name: "John Doe"
- Role: "Founder"
- Order: 1
- Upload a photo

### 6. Test API Endpoints

Once you've added sample data, test the API:

```bash
# Get all podcasts
curl http://localhost:1337/api/podcasts?populate=*

# Get all events
curl http://localhost:1337/api/events?populate=*

# Get featured podcast
curl http://localhost:1337/api/podcasts?filters[featured][$eq]=true&populate=*
```

### 7. Environment Variables

The `.env` file should be created automatically. Verify it contains:

```
HOST=0.0.0.0
PORT=1337
APP_KEYS=<auto-generated>
API_TOKEN_SALT=<auto-generated>
ADMIN_JWT_SECRET=<auto-generated>
TRANSFER_TOKEN_SALT=<auto-generated>
JWT_SECRET=<auto-generated>
```

## API Usage Examples

### Fetch with Populate (to get media files)

```javascript
// Fetch podcasts with all relations and media
fetch('http://localhost:1337/api/podcasts?populate=*')

// Fetch specific fields and relations
fetch('http://localhost:1337/api/podcasts?populate[artwork]=*&populate[tags]=*')

// Fetch with filters
fetch('http://localhost:1337/api/podcasts?filters[featured][$eq]=true&populate=*')

// Fetch with sorting
fetch('http://localhost:1337/api/podcasts?sort=publishDate:desc&populate=*')

// Fetch with pagination
fetch('http://localhost:1337/api/podcasts?pagination[page]=1&pagination[pageSize]=10&populate=*')
```

### Authentication

```javascript
// Register
fetch('http://localhost:1337/api/auth/local/register', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    username: 'user123',
    email: 'user@example.com',
    password: 'password123'
  })
})

// Login
fetch('http://localhost:1337/api/auth/local', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    identifier: 'user@example.com',
    password: 'password123'
  })
})

// Use token
fetch('http://localhost:1337/api/users/me', {
  headers: {
    'Authorization': 'Bearer YOUR_JWT_TOKEN'
  }
})
```

## Troubleshooting

### CORS Issues
If you see CORS errors, verify:
1. `config/middlewares.ts` includes your frontend URL
2. Strapi is running on port 1337
3. Frontend is running on port 5173

### Permission Issues
If API returns 403:
1. Check Settings → Roles → Public
2. Ensure find/findOne are enabled
3. Clear browser cache
4. Restart Strapi

### Media Not Showing
If images don't load:
1. Use full URL: `http://localhost:1337${image.url}`
2. Check file was uploaded in Media Library
3. Verify `populate=*` is in API call

## Next Steps

After setup:
1. ✓ Start Strapi: `npm run develop`
2. ✓ Configure permissions (above)
3. ✓ Add sample content
4. ✓ Test API endpoints
5. → Start frontend: `cd ../pawns-gambit && npm start`
6. → Frontend will connect to Strapi automatically

